<body>
<div class="frontmatter">
<div class="title"><h1>Persistent artifacts</h1></div>
</div>
<div class="body">
<p>It is often desirable to be able to modify files across deployments. To accomplish this, ricochet provides a directory for each content item called <code>persistent</code>. The <code>peristent</code> directory persists across multiple deployments.</p>
<p>For example, you may have a <a href="https://duckdb.org/">DuckDB</a> or <a href="https://www.sqlite.org/">SQLite</a> database that powers your shiny application. If you perform writes to the database and want to persist the storage, it is recommended to store it in <code>persistent</code>.</p>
<h2 id="sec:example-application">Example application</h2>
<p>Below is an example of a Shiny application that utilizes the <code>persistent</code> directory to have shared storage across all instances and deployments of the application.</p>
<pre class="shiki shiki-themes github-light catppuccin-mocha" style="background-color:#fff;--shiki-dark-bg:#1e1e2e;color:#24292e;--shiki-dark:#cdd6f4" tabindex="0"><code><span class="line"><span style="color:#005CC5;font-style:inherit;--shiki-dark:#89B4FA;--shiki-dark-font-style:italic">library</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">shiny</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#005CC5;font-style:inherit;--shiki-dark:#89B4FA;--shiki-dark-font-style:italic">library</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">DBI</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#005CC5;font-style:inherit;--shiki-dark:#89B4FA;--shiki-dark-font-style:italic">library</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">RSQLite</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">db_path </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#032F62;--shiki-dark:#A6E3A1"> "persistent/app_data.sqlite3"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;font-style:inherit;--shiki-dark:#9399B2;--shiki-dark-font-style:italic"># Ensure table exists</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">con </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> dbConnect</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">SQLite</span><span style="color:#24292E;--shiki-dark:#9399B2">(),</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> db_path</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">dbExecute</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">  con</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">  "</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">  CREATE TABLE IF NOT EXISTS messages (</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">    id INTEGER PRIMARY KEY AUTOINCREMENT,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">    message TEXT,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">    submission_time TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">  )</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">dbDisconnect</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">con</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">ui </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> fluidPage</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">  textInput</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#032F62;--shiki-dark:#A6E3A1">"message"</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#005CC5;--shiki-dark:#F38BA8"> NULL</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#E36209;font-style:inherit;--shiki-dark:#EBA0AC;--shiki-dark-font-style:italic"> placeholder</span><span style="color:#D73A49;--shiki-dark:#94E2D5"> =</span><span style="color:#032F62;--shiki-dark:#A6E3A1"> "Enter your message"</span><span style="color:#24292E;--shiki-dark:#9399B2">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">  actionButton</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#032F62;--shiki-dark:#A6E3A1">"submit"</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#032F62;--shiki-dark:#A6E3A1"> "Save Message"</span><span style="color:#24292E;--shiki-dark:#9399B2">),</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">  tableOutput</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#032F62;--shiki-dark:#A6E3A1">"data_table"</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1;font-style:inherit;--shiki-dark:#89B4FA;--shiki-dark-font-style:italic">server</span><span style="color:#D73A49;--shiki-dark:#94E2D5"> &#x3C;-</span><span style="color:#D73A49;--shiki-dark:#CBA6F7"> function</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;font-style:inherit;--shiki-dark:#EBA0AC;--shiki-dark-font-style:italic">input</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#24292E;font-style:inherit;--shiki-dark:#EBA0AC;--shiki-dark-font-style:italic"> output</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#24292E;font-style:inherit;--shiki-dark:#EBA0AC;--shiki-dark-font-style:italic"> session</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span><span style="color:#24292E;--shiki-dark:#9399B2"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">  refresh </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> reactiveVal</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#005CC5;--shiki-dark:#F38BA8">FALSE</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">  observeEvent</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">input</span><span style="color:#D73A49;--shiki-dark:#CBA6F7">$</span><span style="color:#24292E;--shiki-dark:#CDD6F4">submit</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#24292E;--shiki-dark:#9399B2"> {</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#CBA6F7">    if</span><span style="color:#24292E;--shiki-dark:#9399B2"> (</span><span style="color:#005CC5;font-style:inherit;--shiki-dark:#89B4FA;--shiki-dark-font-style:italic">nzchar</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">input</span><span style="color:#D73A49;--shiki-dark:#CBA6F7">$</span><span style="color:#24292E;--shiki-dark:#CDD6F4">message</span><span style="color:#24292E;--shiki-dark:#9399B2">))</span><span style="color:#24292E;--shiki-dark:#9399B2"> {</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">      con </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> dbConnect</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">SQLite</span><span style="color:#24292E;--shiki-dark:#9399B2">(),</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> db_path</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">      dbExecute</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">        con</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">        "INSERT INTO messages (message) VALUES (?)"</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span></span>
<span class="line"><span style="color:#D73A49;--shiki-dark:#CBA6F7">        list</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">input</span><span style="color:#D73A49;--shiki-dark:#CBA6F7">$</span><span style="color:#24292E;--shiki-dark:#CDD6F4">message</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#9399B2">      )</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">      dbDisconnect</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">con</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">      updateTextInput</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">session</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#032F62;--shiki-dark:#A6E3A1"> "message"</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#E36209;font-style:inherit;--shiki-dark:#EBA0AC;--shiki-dark-font-style:italic"> value</span><span style="color:#D73A49;--shiki-dark:#94E2D5"> =</span><span style="color:#032F62;--shiki-dark:#A6E3A1"> ""</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">      refresh</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#D73A49;--shiki-dark:#94E2D5">!</span><span style="color:#24292E;--shiki-dark:#CDD6F4">refresh</span><span style="color:#24292E;--shiki-dark:#9399B2">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#9399B2">    }</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#9399B2">  })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">  df </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> reactive</span><span style="color:#24292E;--shiki-dark:#9399B2">({</span></span>
<span class="line"><span style="color:#6A737D;font-style:inherit;--shiki-dark:#9399B2;--shiki-dark-font-style:italic">    # Force reactivity when trigger changes</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">    refresh</span><span style="color:#24292E;--shiki-dark:#9399B2">()</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">    con </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> dbConnect</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">RSQLite</span><span style="color:#24292E;--shiki-dark:#94E2D5">::</span><span style="color:#24292E;--shiki-dark:#CDD6F4">SQLite</span><span style="color:#24292E;--shiki-dark:#9399B2">(),</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> db_path</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">    data </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> dbGetQuery</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">      con</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span></span>
<span class="line"><span style="color:#032F62;--shiki-dark:#A6E3A1">      "SELECT id, message, submission_time FROM messages ORDER BY id DESC"</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#9399B2">    )</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">    dbDisconnect</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">con</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">    data</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#9399B2">  })</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">  output</span><span style="color:#D73A49;--shiki-dark:#CBA6F7">$</span><span style="color:#24292E;--shiki-dark:#CDD6F4">data_table </span><span style="color:#D73A49;--shiki-dark:#94E2D5">&#x3C;-</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> renderTable</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#005CC5;font-style:inherit;--shiki-dark:#89B4FA;--shiki-dark-font-style:italic">df</span><span style="color:#24292E;--shiki-dark:#9399B2">())</span></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#9399B2">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;--shiki-dark:#CDD6F4">shinyApp</span><span style="color:#24292E;--shiki-dark:#9399B2">(</span><span style="color:#24292E;--shiki-dark:#CDD6F4">ui</span><span style="color:#24292E;--shiki-dark:#9399B2">,</span><span style="color:#24292E;--shiki-dark:#CDD6F4"> server</span><span style="color:#24292E;--shiki-dark:#9399B2">)</span></span>
<span class="line"></span></code></pre>
</div>
</body>